---
title: "ã€Flutterã€‘Sizerå¯¾å¿œã—ãŸGoldenTestã‚’å®Ÿè£…ã™ã‚‹"
emoji: "ğŸ†"
type: "tech"
topics:
  - "flutter"
  - "test"
  - "dart"
published: true
published_at: "2021-10-30 11:42"
---

# ã¯ã˜ã‚ã«
Flutterã§ã‚¢ãƒ—ãƒªã‚’é–‹ç™ºã™ã‚‹æ™‚ã®Resposiveå¯¾å¿œã§[Sizer](https://pub.dev/packages/sizer)ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚’ä½¿ã†æ–¹å¤šã„ã‚“ã˜ã‚ƒãªã„ã§ã—ã‚‡ã†ã‹ã€‚

ä»Šå›ã¯ãã®Sizerãƒ©ã‚¤ãƒ–ãƒ©ãƒªã«å¯¾å¿œã—ãŸGoldenTestã‚’å®Ÿè£…ã—ã¦ã„ãã¾ã™ã€‚
å®Ÿè£…ãã®ã‚‚ã®ã¯ç°¡å˜ã§ã™ãŒã€è©°ã¾ã£ãŸã¨ã“ã‚ãŒã‚ã£ãŸã®ã§æ›¸ãç•™ã‚ã¦ãŠãã¾ã™ã€‚

# GoldenTestãªã«ãã‚Œï¼Ÿ
ã£ã¦æ–¹ã¯ä»¥ä¸‹è¨˜äº‹ã‚’å‚è€ƒã«ã—ã¦ãã ã•ã„ã€‚
https://zenn.dev/matsumaru/articles/c2bf8ec468cff8
https://zenn.dev/matsumaru/articles/44b4dc9927bb41
https://zenn.dev/matsumaru/articles/0971ee5af5fdc9

# ä»Šå›ã®ã‚´ãƒ¼ãƒ«
GoldenTestã®ãƒã‚¹ã‚¿ãƒ¼ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã‚·ãƒ§ãƒƒãƒˆã§ã€å®Ÿæ©Ÿã¨åŒã˜ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆã«ã™ã‚‹ã“ã¨ã‚’ç›®æ¨™ã¨ã—ã¾ã™ã€‚ä»¥ä¸‹ç”»åƒã®ã‚ˆã†ã«ãªã‚Œã°OKã¨ã™ã‚‹ã€‚
FirstPageã¯Iconã¨Textã ã‘ã®ã‚·ãƒ³ãƒ—ãƒ«ãªWidgetã§Sizerã‚’ä½¿ã£ã¦ã„ã‚‹ã®ã§ãƒ‡ãƒã‚¤ã‚¹ã‚µã‚¤ã‚ºã«å¿œã˜ã¦å¤‰åŒ–ã—ã¾ã™ã€‚FirstPageã®ä¸­èº«ã¯æœ€å¾Œã®æ–¹ã«ã®ã›ã¦ãŠãã¾ã™ã€‚

**å®Ÿæ©Ÿã®ç”»é¢**
| FirstPageï¼ˆå°ï¼‰ | FirstPageï¼ˆå¤§ï¼‰ | 
| ---- | ---- | 
| ![](https://storage.googleapis.com/zenn-user-upload/f979be5bed7a003b9f4a45bc.png =700x) | ![](https://storage.googleapis.com/zenn-user-upload/0ca1d5c333331259181d5919.png) | 

**GoldenTestã®ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã‚·ãƒ§ãƒƒãƒˆ**
| FirstPageï¼ˆå°ï¼‰ | FirstPageï¼ˆå¤§ï¼‰ | 
| ---- | ---- | 
| ![](https://storage.googleapis.com/zenn-user-upload/8836799b6866b78440fe13ed.png =400x) | ![](https://storage.googleapis.com/zenn-user-upload/71a18ef0913de891052e06a2.png) | 


# Sizerå¯¾å¿œ
ãŸã å˜ã«testã§Sizerã‚’å…¥ã‚Œã‚‹ã ã‘ã§ã™ã€‚
```dart
void main() {
  testGoldens('golden test', (WidgetTester tester) async {
    await loadAppFonts();

    //ãƒ†ã‚¹ãƒˆã—ãŸã„Widgetã‚’Sizerã§åŒ…ã‚“ã§ã‚ã’ã‚‹ã€‚
    final widget = Sizer(builder: (context, orientation, deviceType) {
    ã€€ã€€ã€€ã€€//ä»»æ„ã®Widget
      return FirstPage();
    });

    await tester.pumpWidgetBuilder(widget);
    await multiScreenGolden(tester, 'golden_test');
  });
}
```

ã‚‚ã—ã€Sizerã§åŒ…ã‚“ã§ã„ãªã„å ´åˆã¯ä»¥ä¸‹ã®ã‚ˆã†ãªã‚¨ãƒ©ãƒ¼ãŒå‡ºã¦ãã‚‹ã¨æ€ã„ã¾ã™ã€‚
```
â•â•â•¡ EXCEPTION CAUGHT BY WIDGETS LIBRARY â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
The following LateError was thrown building FirstPage(dirty):
LateInitializationError: Field 'width' has not been initialized.

The relevant error-causing widget was:
  FirstPage

When the exception was thrown, this was the stack:
#0      SizerUtil.width (package:sizer/util.dart)
#1      SizerExt.w (package:sizer/extension.dart:12:36)
#2      FirstPage.build (package:sizer_golden_test_demo/main.dart:35:25)
#3      StatelessElement.build (package:flutter/src/widgets/framework.dart:4739:28)
#4      ComponentElement.performRebuild (package:flutter/src/widgets/framework.dart:4665:15)
#5      Element.rebuild (package:flutter/src/widgets/framework.dart:4355:5)
#6      ComponentElement._firstBuild (package:flutter/src/widgets/framework.dart:4643:5)
#7      ComponentElement.mount (package:flutter/src/widgets/framework.dart:4638:5)
...     Normal element mounting (211 frames)
#218    Element.inflateWidget (package:flutter/src/widgets/framework.dart:3673:14)
#219    MultiChildRenderObjectElement.inflateWidget (package:flutter/src/widgets/framework.dart:6333:36)
#220    MultiChildRenderObjectElement.mount (package:flutter/src/widgets/framework.dart:6344:32)
...     Normal element mounting (362 frames)
#582    Element.inflateWidget (package:flutter/src/widgets/framework.dart:3673:14)
#583    Element.updateChild (package:flutter/src/widgets/framework.dart:3422:20)
#584    RenderObjectToWidgetElement._rebuild (package:flutter/src/widgets/binding.dart:1198:16)
#585    RenderObjectToWidgetElement.update (package:flutter/src/widgets/binding.dart:1175:5)
#586    RenderObjectToWidgetElement.performRebuild (package:flutter/src/widgets/binding.dart:1189:7)
#587    Element.rebuild (package:flutter/src/widgets/framework.dart:4355:5)
#588    BuildOwner.buildScope (package:flutter/src/widgets/framework.dart:2620:33)
#589    AutomatedTestWidgetsFlutterBinding.drawFrame (package:flutter_test/src/binding.dart:1139:19)
#590    RendererBinding._handlePersistentFrameCallback (package:flutter/src/rendering/binding.dart:319:5)
#591    SchedulerBinding._invokeFrameCallback (package:flutter/src/scheduler/binding.dart:1143:15)
#592    SchedulerBinding.handleDrawFrame (package:flutter/src/scheduler/binding.dart:1080:9)
#593    AutomatedTestWidgetsFlutterBinding.pump.<anonymous closure> (package:flutter_test/src/binding.dart:1006:9)
#596    TestAsyncUtils.guard (package:flutter_test/src/test_async_utils.dart:71:41)
#597    AutomatedTestWidgetsFlutterBinding.pump (package:flutter_test/src/binding.dart:993:27)
#598    WidgetTester.pumpWidget.<anonymous closure> (package:flutter_test/src/widget_tester.dart:554:22)
#601    TestAsyncUtils.guard (package:flutter_test/src/test_async_utils.dart:71:41)
#602    WidgetTester.pumpWidget (package:flutter_test/src/widget_tester.dart:551:27)
#603    _pumpAppWidget (package:golden_toolkit/src/testing_tools.dart:128:16)
```

# è©°ã¾ã£ãŸã¨ã“ã‚

ã¡ã‚ƒã‚“ã¨Sizerã§åŒ…ã‚“ã§ã‚„ã£ãŸã®ã§ã‚‚ã†å¤§ä¸ˆå¤«ã ã¨æ€ã£ã¦ã„ãŸã‚‰ã€ãªã‚“ã ã‹ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆãŒå®Ÿæ©Ÿã¨å…¨ç„¶é•ã†ç¾è±¡ãŒãŠãã¾ã—ãŸã€‚

ãã®åŸå› ã¯```const```ã§ã—ãŸï¼
ãƒ†ã‚¹ãƒˆã—ãŸã„Widgetã«```const```ãŒã¤ã„ã¦ã„ã‚‹å ´åˆã€```multiScreenGolden```ã‚’å®Ÿè¡Œã—ã¦ã‚‚ã€ãƒ‡ãƒã‚¤ã‚¹ã‚µã‚¤ã‚ºã«å¿œã˜ã¦ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆãŒå¤‰ã‚ã£ã¦ãã‚Œã¾ã›ã‚“ã€‚

æ¨¡æ“¬çš„ã«testå†…ã§Widgetã«constã‚’ã¤ã‘ã¦```flutter test --update-goldens```ã—ã¦ã¿ã‚‹ã¨ã€ã€

```dart
void main() {
  testGoldens('golden test', (WidgetTester tester) async {
    await loadAppFonts();

    final widget = Sizer(builder: (context, orientation, deviceType) {
    ã€€ã€€ã€€ã€€//ä»»æ„ã®Widgetã«constãŒã¤ã„ã¦ã„ã‚‹ã¨ã™ã‚‹
      return const FirstPage();
    });

    await tester.pumpWidgetBuilder(widget);
    await multiScreenGolden(tester, 'golden_test');
  });
}
```
**GoldenTestã®ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã‚·ãƒ§ãƒƒãƒˆ(constæœ‰ã‚Šãƒ‘ã‚¿ãƒ¼ãƒ³)**
| Head | Head | 
| ---- | ---- | 
| ![](https://storage.googleapis.com/zenn-user-upload/d95ca81acc182cb985d63db0.png =400x) | ![](https://storage.googleapis.com/zenn-user-upload/fac1827c2d14b27c9341efbe.png) | 

è¦‹ã¦ã®é€šã‚ŠIconã‚‚Textã‚‚ã‚µã‚¤ã‚ºãŒå¤‰ã‚ã£ã¦ãŠã‚‰ãšã€Sizerå¯¾å¿œã—ã¦ã„ãªã„ã§ã™ã€‚

:::message alert
ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆãŒå®Ÿæ©Ÿã¨é•ã†å ´åˆã¯```const```ã‚’ç–‘ãˆï¼
:::

# FirstPage
ä»Šå›ãƒ†ã‚¹ãƒˆã—ã¦ã„ã‚‹Widgetã§ã™ã€‚
```dart
import 'package:flutter/material.dart';
import 'package:sizer/sizer.dart';

void main() {
  runApp(const MyApp());
}

class MyApp extends StatelessWidget {
  const MyApp({Key? key}) : super(key: key);

  @override
  Widget build(BuildContext context) {
    return Sizer(builder: (context, orientation, deviceType) {
      return MaterialApp(
        title: 'Flutter Demo',
        theme: ThemeData(
          primarySwatch: Colors.blue,
        ),
        home: FirstPage(),
      );
    });
  }
}

class FirstPage extends StatelessWidget {
  const FirstPage({Key? key}) : super(key: key);
  @override
  Widget build(BuildContext context) {
    return Scaffold(
      body: Center(
        child: Column(
          mainAxisAlignment: MainAxisAlignment.center,
          children: [
            Container(
              width: 20.w,
              height: 30.h,
              child: Icon(
                Icons.flutter_dash_rounded,
                size: 40.sp,
              ),
            ),
            Text('Hello world', style: TextStyle(fontSize: 12.sp)),
          ],
        ),
      ),
    );
  }
}
```

# çµ‚ã‚ã‚Šã«
å‚è€ƒã«ãªã‚Œã°å¹¸ã„ã§ã™ã€‚