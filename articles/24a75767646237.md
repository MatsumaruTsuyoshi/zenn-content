---
title: "Flutterã§ã‚¹ãƒˆãƒ­ãƒ¢ãƒ¼ã‚·ãƒ§ãƒ³ã‚’å®Ÿè£…ã—ã¦ã¿ãŸ"
emoji: "ğŸ“š"
type: "tech"
topics:
  - "flutter"
published: false
published_at: "2023-06-30 14:44"
---

## ã‚¹ãƒˆãƒ­ãƒ¢ãƒ¼ã‚·ãƒ§ãƒ³ã¨ã¯

ã‚¹ãƒˆãƒ­ãƒ¢ãƒ¼ã‚·ãƒ§ãƒ³ã¯ã€å‹•ãã®ä¸€é€£ã®å‹•ä½œã‚’æ®‹åƒï¼ˆè»Œè·¡ï¼‰ã¨ã—ã¦ç”»é¢ä¸Šã«è¡¨ç¤ºã™ã‚‹ã‚‚ã®ã§ã™ã€‚ä¾‹ãˆã°ä»¥ä¸‹ç”»åƒã®ã‚ˆã†ãªã‚‚ã®ã§ã™ã€‚

![](https://storage.googleapis.com/zenn-user-upload/f8eabbba5cb1-20230617.png)
[å¼•ç”¨](https://twitter.com/dartfish_japan/status/1204709993540247557/photo/1)

ã‚¹ãƒãƒ¼ãƒ„é–¢é€£ã§ä½¿ã‚ã‚Œã‚‹ã“ã¨ãŒå¤šã„ã¿ãŸã„ã§ã™ã€‚ãŸã¾ãƒ¼ã«è¦‹ã‹ã‘ã‚‹ã“ã¨ãŒã‚ã‚Šã¾ã™ã‚ˆã­ã€‚


## ä»Šå›ã®è¨˜äº‹ã®ç›®çš„

Flutterã§ã‚¹ãƒˆãƒ­ãƒ¢ãƒ¼ã‚·ãƒ§ãƒ³ç”»åƒã‚’ç”Ÿæˆã™ã‚‹å®Ÿè£…ã‚’ã—ã¦ã¿ãŸã®ã§ã€ãã®ä¸­èº«ã«ã¤ã„ã¦è§£èª¬ã—ã¾ã™ã€‚

ã‚ªãƒªã‚¸ãƒŠãƒ«å‹•ç”»ã‚’å‡¦ç†ã—ã¦ä¸‹è¨˜ã‚¹ãƒˆãƒ­ãƒ¢ãƒ¼ã‚·ãƒ§ãƒ³ç”»åƒã‚’ç”Ÿæˆã—ã¾ã—ãŸã€‚è¨ˆç®—è‡ªä½“ã¯ã‚·ãƒ³ãƒ—ãƒ«ãªã®ã§ä»Šå›ã®è¨˜äº‹ã‚’è¦‹ã¦ã‚‚ã‚‰ãˆã‚Œã°Flutterã ã‘ã§ãªãä»–ã®è¨€èªã§ã‚‚å®Ÿè£…ã§ãã‚‹ã¨æ€ã„ã¾ã™ã€‚
![](https://storage.googleapis.com/zenn-user-upload/5f73b4bc788c-20230618.png =650x)
*ã‚¹ãƒˆãƒ­ãƒ¢ãƒ¼ã‚·ãƒ§ãƒ³ç”»åƒ*


![](https://storage.googleapis.com/zenn-user-upload/8df10b041b8c-20230618.gif =650x)
*ã‚ªãƒªã‚¸ãƒŠãƒ«å‹•ç”»*



## äºˆå‚™çŸ¥è­˜

ã“ã‚Œã‹ã‚‰ã“ã‚Œã‹ã‚‰è©³ç´°ã‚’èª¬æ˜ã™ã‚‹ã«ã‚ãŸã£ã¦ã„ãã¤ã‹äºˆå‚™çŸ¥è­˜ãŒå¿…è¦ã«ãªã‚‹ã®ã§å°‘ã—èª¬æ˜ã—ã¦ã„ãã¾ã™ã€‚
ç†è§£ã•ã‚Œã¦ã„ã‚‹æ–¹ã¯é£›ã°ã—ã¦ã‚‚ã‚‰ã£ã¦å¤§ä¸ˆå¤«ã§ã™ã€‚

### ç”»åƒã®æ§‹é€ ã«ã¤ã„ã¦


ç”»åƒã¯ç”»ç´ (ãƒ”ã‚¯ã‚»ãƒ«:pixel)ã®é›†åˆä½“ã§ã™ã€‚ãã—ã¦ãã‚Œãã‚Œã®ç”»ç´ ã«ã¯è‰²æƒ…å ±ï¼ˆä¾‹ãˆã°RGBãªã©ï¼‰ã‚’æŒã£ã¦ã„ã¾ã™ã€‚

ä»¥ä¸‹ã‚¤ãƒ¡ãƒ¼ã‚¸å›³ã§ã™ã€‚

![](https://storage.googleapis.com/zenn-user-upload/023c0b0213ab-20230617.png)

![](https://storage.googleapis.com/zenn-user-upload/f739c371e509-20230617.png)

ä»Šå›ã¯ã“ã®ç”»ç´ (ãƒ”ã‚¯ã‚»ãƒ«:pixel)ã‚’ç”¨ã„ã¦è¨ˆç®—ã™ã‚‹ã®ã§ã€ã“ã®ç”»åƒã®æ§‹é€ ä½“ã‚’ã‚¤ãƒ¡ãƒ¼ã‚¸ã—ã¦ã‚‚ã‚‰ãˆã‚Œã°ååˆ†ã ã¨æ€ã£ã¦ã¾ã™ã€‚

è©³ã—ãã¯ã“ã¡ã‚‰ã‚’å‚è€ƒã«ã—ã¦ãã ã•ã„ã€‚
http://neareal.com/470/

### è‰²æƒ…å ±

ä»Šå›ã¯è‰²ã®å‡¦ç†ã‚‚ã™ã‚‹ã®ã§ã€å°‘ã—è£œè¶³ã—ã¦ãŠãã¾ã™ã€‚ä»Šå›ç”¨ã„ã‚‹ã®ã¯RGBã¨HSVã«ãªã‚Šã¾ã™ã€‚

RGBã¯èµ¤ ã€ç·‘ ã€é’ ã®ä¸‰ã¤ã®åŸè‰²ã‚’æ··ãœã¦å¹…åºƒã„è‰²ã‚’å†ç¾ã™ã‚‹åŠ æ³•æ··åˆã®ä¸€ç¨®ã§ã‚ã‚‹ã€‚RGBã¯ã‚³ãƒ³ãƒ”ãƒ¥ãƒ¼ã‚¿ãŒãƒ‡ã‚£ã‚¹ãƒ—ãƒ¬ã‚¤ã«è‰²ã‚’è¡¨ç¤ºã™ã‚‹ã®ã«ä½¿ã‚ã‚Œã¦ã„ã¾ã™ã€‚

HSVã¯è‰²ç›¸ï¼ˆhueï¼‰ãƒ»æ˜åº¦ï¼ˆlightnessï¼‰ãƒ»å½©åº¦ï¼ˆsaturationï¼‰ã® 3 ã¤ã®åŸºæº–ã‹ã‚‰è‰²ã‚’åˆ†é¡ã—ã¾ã™ã€‚HSVã®ã»ã†ãŒäººé–“ã®èªè­˜ã™ã‚‹è‰²ã«è¿‘ã„ã®ã§ãƒ‡ã‚¶ã‚¤ãƒ³ãªã©ã§ã‚ˆãç”¨ã„ã‚‰ã‚Œã¦ã„ã¾ã™ã€‚

é•ã„ã®è©³ç´°ã«ã¤ã„ã¦ã¯ã“ã¡ã‚‰ã‚’å‚è€ƒã«ã—ã¦ãã ã•ã„ã€‚
https://web.wiis.info/web-development/classification-of-colors-hsv-rgb-and-hex/


ä»Šå›ã¯è‰²æŠ½å‡ºã‚’ã™ã‚‹éš›ã«ã€RGBã‚ˆã‚ŠHSVã®æ–¹ãŒé©ã—ã¦ã„ã‚‹å ´åˆã‚‚ã‚ã‚‹ã®ã§RGBâ‡„HSVå¤‰æ›ã‚’ã—ã¦ã„ãã¾ã™ã€‚

https://www.frontier.maxell.co.jp/blog/posts/43.html

## ã©ã‚“ãªå‡¦ç†ã—ã¦ã‚‹ï¼Ÿ

ã“ã“ã§ã¯ã‚¹ãƒˆãƒ­ãƒ¢ãƒ¼ã‚·ãƒ§ãƒ³ã®è¡¨ç¤ºã™ã‚‹ã¾ã§ã«ã©ã®ã‚ˆã†ãªå‡¦ç†ã‚’ã—ã¦ã„ã‚‹ã‹èª¬æ˜ã—ã¦ã„ãã¾ã™ã€‚

:::message
å‡¦ç†ã™ã‚‹å‹•ç”»ã¯å›ºå®šã‚«ãƒ¡ãƒ©ã§æ’®å½±ã•ã‚Œã¦ã„ã‚‹ã“ã¨ãŒé‡è¦ã§ã™ã€‚
:::

ãã‚Œã§ã¯ä»¥ä¸‹æ‰‹é †ã§ã™ã€‚ã–ã£ãã‚Šåˆ†ã‘ã¾ã—ãŸã€‚

1. å‹•ç”»ã‚’ç”»åƒã«åˆ†å‰²ã™ã‚‹ã€‚
2. åˆ†å‰²ã—ãŸç”»åƒãŸã¡ã‹ã‚‰ãƒ™ãƒ¼ã‚¹ç”»åƒã‚’ä½œã‚‹ã€‚
3. ãƒ™ãƒ¼ã‚¹ç”»åƒã¨åˆ†å‰²ã—ãŸç”»åƒã¨ã®å·®åˆ†ã‚’å–ã£ã¦ä»»æ„ã®ã—ãã„å€¤ã‚’è¶…ãˆãŸã‚‚ã®ã ã‘è¿½åŠ 



#### 1.å‹•ç”»ã‚’ç”»åƒã«åˆ†å‰²ã™ã‚‹

å½“ãŸã‚Šå‰ã§ã™ãŒå‹•ç”»ã¯ç”»åƒã®é€£ç¶šãªã®ã§ã¾ãšã¯ç”»åƒã«åˆ†å‰²ã—ã¦ã„ãã¾ã™ã€‚

![](https://storage.googleapis.com/zenn-user-upload/1602fd210815-20230618.png)
*ã‚¤ãƒ¡ãƒ¼ã‚¸å›³*

ä»Šå›ã¯[export_video_frame](https://pub.dev/packages/export_video_frame)ã‚’ä½¿ã„ã¾ã—ãŸã€‚


```dart
/// å‹•ç”»ã‚’ç”»åƒã«åˆ†å‰²ã™ã‚‹ã€‚ä»Šå›ã®ä¾‹ã ã¨ï¼“ï¼åˆ†å‰²ã€‚
var images = await ExportVideoFrame.exportImage(file.path, 30, 1);
imageList = images.map((file) => Image.file(file)).toList();
```

#### 2.åˆ†å‰²ã—ãŸç”»åƒãŸã¡ã‹ã‚‰ãƒ™ãƒ¼ã‚¹ç”»åƒã‚’ä½œã‚‹

![](https://storage.googleapis.com/zenn-user-upload/758168383059-20230618.png)
*ã‚¤ãƒ¡ãƒ¼ã‚¸å›³*

ãƒ™ãƒ¼ã‚¹ç”»åƒã¨ã¯å…ˆã»ã©å‡¦ç†ã—ãŸåˆ†å‰²ã—ãŸè¤‡æ•°ç”»åƒã‹ã‚‰ç”Ÿæˆã—ã¾ã™ã€‚ãƒ™ãƒ¼ã‚¹ç”»åƒã¨ã„ã†ã¨å°‘ã—åˆ†ã‹ã‚Šã¥ã‚‰ã„ã§ã™ãŒã€è¤‡æ•°ç”»åƒã®å¹³å‡ã‚„ä¸­å¤®å€¤ã‹ã‚‰ç”Ÿæˆã—ãŸç”»åƒã®ã“ã¨ã‚’æŒ‡ã—ã¾ã™ã€‚

å¾“ã£ã¦åˆ†å‰²ã—ãŸè¤‡æ•°ç”»åƒã®åŒã˜ç”»ç´ ã®å¹³å‡ã‚„ä¸­å¤®å€¤ã‚’è¨ˆç®—ã—ã¾ã™ã€‚

ã“ã¡ã‚‰ãŒä¸­å¤®å€¤ã§è¨ˆç®—ã—ãŸãƒ™ãƒ¼ã‚¹ç”»åƒã«ãªã‚Šã¾ã™ã€‚
![](https://storage.googleapis.com/zenn-user-upload/529f9ef70309-20230630.png)

å®Ÿè£…ã¯ã“ã¡ã‚‰ã€‚

```dart
/// è¤‡æ•°ç”»åƒã®RGBList
List<List<List<Color>>> imagesRGBList = [];

/// è¤‡æ•°ç”»åƒã®è¤‡æ•°hsvæƒ…å ±ã‚’æŒã£ã¦ã„ã‚‹Listã€‚ã‚ã¨ã§ä¸­å¤®å€¤ã‚’è¨ˆç®—ã™ã‚‹ãŸã‚ã«å¿…è¦ã€‚
List<List<List<HSVColorElementList>>> hsvElementList = [];

/// ä¸­å¤®å€¤ã§ãƒ™ãƒ¼ã‚¹ç”»åƒã‚’ä½œã‚‹ã®ã«å¿…è¦ã€‚
List<List<Color>> medianRGBList = [];

final imageLength = imageList.length;
int loop = 0;

/// åˆ†å‰²ã—ãŸç”»åƒãŸã¡ã‹ã‚‰ãƒ™ãƒ¼ã‚¹ç”»åƒã‚’ä½œã‚‹
for (final image in images) {
  loop++;
  
  /// ç”»åƒã‚’byteã«å¤‰æ›
  final decodedBytes = await util.fileToBytes(file: image);
  if (decodedBytes == null) return;
  
  /// ä»®ã®Listã‚’ä½œæˆ
  final List<List<Color>> imgArr = [];
  final List<List<List<HSVColorElementList>>> tmpHsvElementList = [];
  for (int y = 0; y < imageHeight; y++) {
    imgArr.add([]);
    tmpHsvElementList.add([]);
    medianRGBList.add([]);
    
    /// 1ç”»ç´ ã”ã¨ã®å‡¦ç†ã€‚
    for (int x = 0; x < imageWidth; x++) {
    
      /// byteã‹ã‚‰Color(RGB)ã«å¤‰æ›ã€‚
      final color = util.byteToRGB(bytes: decodedBytes, y: y, x: x, imageWidth: imageWidth);
      imgArr[y].add(color);
      
      /// RGBã‹ã‚‰HSVã«å¤‰æ›ã€‚
      final hsv = util.rgbToHSV(color.red, color.green, color.blue);
      tmpHsvElementList[y].add([
        HSVColorElementList(
          alphaList: [hsv.alpha],
          hueList: [hsv.hue],
          saturationList: [hsv.saturation],
          valueList: [hsv.value],
        )
      ]);
      if (hsvElementList.isNotEmpty) {
        /// å¾Œã€…ä¸­å¤®å€¤ã‚’è¨ˆç®—ã—ãŸã„ã®ã§æ•°å€¤ã‚’ãŸã‚ã¦ã„ãã€‚
        final elementList = hsvElementList[y][x].first;
        elementList.alphaList.add(hsv.alpha);
        elementList.hueList.add(hsv.hue);
        elementList.saturationList.add(hsv.saturation);
        elementList.valueList.add(hsv.value);
      }
      
      /// æœ€å¾Œã®ãƒ«ãƒ¼ãƒ—ã§ä¸­å¤®å€¤ã‚’è¨ˆç®—ã™ã‚‹ã€‚
      if (loop == imageLength) {
        final elementList = hsvElementList[y][x].first;
        final medianHsv = HSVColor.fromAHSV(
          /// alphaMedianã¯è‡ªä½œã‚¯ãƒ©ã‚¹ã€‚sortã—ã¦ä¸­å¤®å€¤ã‚’è¨ˆç®—ã—ã¦ã¾ã™ã€‚
          elementList.alphaMedian,
          elementList.hueMedian,
          elementList.saturationMedian,
          elementList.valueMedian,
        );
	
        /// HSVã‹ã‚‰RGBã«å¤‰æ›ã—ã¦è¿½åŠ ã€‚
        medianRGBList[y].add(util.hsvToColor(medianHsv));
      }
    }
  }
  if (hsvElementList.isEmpty) {
    hsvElementList.addAll(tmpHsvElementList);
  }
  imagesRGBList.add(imgArr);
}

```

#### 3.ãƒ™ãƒ¼ã‚¹ç”»åƒã¨åˆ†å‰²ã—ãŸç”»åƒã¨ã®å·®åˆ†ã‚’å–ã£ã¦ä»»æ„ã®ã—ãã„å€¤ã‚’è¶…ãˆãŸã‚‚ã®ã ã‘è¿½åŠ 

ã‚¤ãƒ¡ãƒ¼ã‚¸ã¯ã“ã‚“ãªæ„Ÿã˜ã§ã™ã€‚

![](https://storage.googleapis.com/zenn-user-upload/48efc29a3610-20230630.png)

ãã‚Œãã‚Œã®ç”»ç´ ã”ã¨ã«æ¯”è¼ƒã—ã¦ä»»æ„ã®ã—ãã„å€¤ã‚’è¶…ãˆãŸã‚‚ã®ã ã‘ãƒ—ãƒ­ãƒƒãƒˆã—ã¦ã„ãã€æœ€çµ‚çš„ã«ã‚¹ãƒˆãƒ­ãƒ¢ãƒ¼ã‚·ãƒ§ãƒ³ç”»åƒãŒã§ãã‚ãŒã‚Šã¾ã™ã€‚

![](https://storage.googleapis.com/zenn-user-upload/5f73b4bc788c-20230618.png =650x)
*ã‚¹ãƒˆãƒ­ãƒ¢ãƒ¼ã‚·ãƒ§ãƒ³ç”»åƒ*


```dart
/// ã‚¹ãƒˆãƒ­ãƒ¢ãƒ¼ã‚·ãƒ§ãƒ³ç”»åƒç”¨ã®List
List<List<Color>> stromationRGBList = [];
int page = 0;
for (final imageRGBList in imagesRGBList) {
  for (int y = 0; y < imageHeight; y++) {
    if (page == 0) {
      stromationRGBList.add([]);
    }
    /// 1ç”»ç´ ã”ã¨ã®å‡¦ç†
    for (int x = 0; x < imageWidth; x++) {
      final currentR = imageRGBList[y][x].red;
      final currentG = imageRGBList[y][x].green;
      final currentB = imageRGBList[y][x].blue;
      /// Redä¸­å¤®å€¤
      final medianR = medianRGBList[y][x].red;
      final diffR = (currentR - medianR).abs();
      /// Greenä¸­å¤®å€¤
      final medianG = medianRGBList[y][x].green;
      final diffG = (currentG - medianG).abs();
      /// Blueä¸­å¤®å€¤
      final medianB = medianRGBList[y][x].blue;
      final diffB = (currentB - medianB).abs();
      if (page == 0) {
        stromationRGBList[y].add(Color.fromRGBO(medianR, medianG, medianB, 1));
      }
      /// ã—ãã„å€¤ã‚’è¶…ãˆãŸã‹åˆ¤å®šã™ã‚‹
      if (diffR > threshold || diffG > threshold || diffB > threshold) {
        stromationRGBList[y][x] = Color.fromRGBO(currentR, currentG, currentB, 1);
      }
    }
  }
  page++;
}
```



## ãŠã‚ã‚Šã«

è¨ˆç®—ãŒé…ã„ã®ã§Flutterã‹ã‚‰opencvã‚’ä½¿ã£ã¦ã¿ãŸã‚‰çˆ†é€Ÿã§æœ€é«˜ã€‚

Githubã®ã›ã¦ãŠãã€‚
