---
title: "ã€å…¥é–€ã€‘Flutterã§DeepLinkã‚’å®Ÿè£…ã—ã¦ã¿ã‚ˆã†ã€‚"
emoji: "ğŸ”—"
type: "tech"
topics:
  - "flutter"
  - "dart"
  - "deeplink"
published: true
published_at: "2022-03-12 09:07"
---

# DeepLinkã¨ã¯
ã‚ã‚‹ãƒªãƒ³ã‚¯ã‚’ã‚¯ãƒªãƒƒã‚¯ã™ã‚‹ã¨ç‰¹å®šã®ã‚¢ãƒ—ãƒªã‚’é–‹ãã‚ˆã†ãªãƒªãƒ³ã‚¯ã®ã“ã¨ã‚’DeepLinkã¨ã„ã„ã¾ã™ã€‚ä»–ã®å‘¼ã³åã¨ã—ã¦ã€ŒUniversal Linksã€ã€ã€Œdynamic linksã€ã€ã€ŒApp Linksã€ãªã©ã‚‚ã‚ã‚‹ã‚ˆã†ã§ã™ãŒã©ã‚Œã‚‚ã»ã¼åŒã˜æ„å‘³ã§ã™ã€‚

ã€è¿½è¨˜ã€‘DeepLinkã®ç´°ã‹ã„é•ã„ã«ã¤ã„ã¦ã“ã®è¨˜äº‹ãŒã‚ã‹ã‚Šã‚„ã™ã‹ã£ãŸã§ã™ã€‚
https://zenn.dev/msorz/articles/72a282ff71a350


DeepLinkã®èº«è¿‘ãªä¾‹ã§ã„ã†ã¨ã€Webãƒšãƒ¼ã‚¸ã§ãƒãƒƒãƒˆã‚µãƒ¼ãƒ•ã‚£ãƒ³ã—ã¦ã„ã‚‹æ™‚ã«SNSã®æŠ•ç¨¿ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ãŸã‚‰Twitterã‚„Instagramã®ã‚¢ãƒ—ãƒªã«ç§»å‹•ã—ã¦ã‚¢ãƒ—ãƒªå´ã§è©³ç´°è¡¨ç¤ºã•ã‚Œã‚‹ã‚ã‚Œã§ã™ã€‚ã‚ã‚ŒãŒDeepLinkã§ã™ã€‚


ã‚¤ãƒ¡ãƒ¼ã‚¸ã‚’æ´ã‚€ã«ã¯ä»¥ä¸‹å‹•ç”»ãŒåˆ†ã‹ã‚Šã‚„ã™ãã¦è‰¯ã„ã¨æ€ã„ã¾ã™ã€‚
https://www.youtube.com/watch?v=LvY1JMcrPF8&list=PLl-K7zZEsYLmOF_07IayrTntevxtbUxDL

å¾“ã£ã¦ã€ãƒ¡ãƒ¼ãƒ«ã‚„SNSã€DMã‹ã‚‰ç›´æ¥ã‚¢ãƒ—ãƒªã‚’é–‹ã‘ã‚‹ã‚ˆã†ã«ã™ã‚‹ã‚ˆã†ãªæ©Ÿèƒ½ã‚’å®Ÿç¾ã—ãŸã„å ´åˆã¯DeepLinkã‚’ä½¿ã†ã®ãŒè‰¯ã•ãã†ã§ã™ã€‚
ã¾ãŸDeepLinkã«å¤‰æ•°ï¼ˆãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ï¼‰ã‚’ä¸ãˆã€ãã‚Œã«å¿œã˜ãŸå‡¦ç†ã‚’ã‹ã¾ã›ã‚‹ã“ã¨ã§æ‹›å¾…æ©Ÿèƒ½ã‚„ç‰¹å®šã®ç”»é¢ã‚’è¡¨ç¤ºã™ã‚‹ãªã©è‡ªç”±ãªè¨­è¨ˆãŒå¯èƒ½ã§ã™ã€‚

# ã“ã®è¨˜äº‹ã«æ›¸ã„ã¦ã‚ã‚‹ã“ã¨
- ç°¡å˜ãªDeepLinkã‚¢ãƒ—ãƒªã®ä½œæˆã¨å‹•ä½œç¢ºèª
- ä»»æ„ã®classã§DeepLinkã‚’å—ã‘å–ã‚‹æ–¹æ³•

ã¨ã‚Šã‚ãˆãšDeeplinkã‚’å‹•ã‹ã—ã¦ã¿ãŸã„æ–¹å¯¾è±¡ã§ã™ã€‚å®Ÿè£…ãã®ã‚‚ã®ã¯ç°¡å˜ã§ã™ãŒã€è¨­å®šã§ãƒŸã‚¹ã‚‹ã¨æ²¼ã£ã¦ã—ã¾ã†ã®ã§ã”æ³¨æ„ãã ã•ã„ï¼

ã¡ãªã¿ã«ä»Šå›ã¯ä»¥ä¸‹ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚’ä½¿ã£ã¦å®Ÿè£…ã—ã¦ã„ã“ã†ã¨æ€ã„ã¾ã™ã€‚
https://pub.dev/packages/uni_links


ã¾ãŸã€åŸºæœ¬ã¯å…¬å¼ãƒšãƒ¼ã‚¸ã«æ›¸ã„ã¦ã‚ã‚Šã¾ã™ã®ã§ç›®ã‚’é€šã—ã¦ã¿ã¦ãã ã•ã„ã€‚
https://docs.flutter.dev/development/ui/navigation/deep-linking

ã‚ã¨ã¯å®Ÿè£…ã—ã¦ã„ãä¸Šã§URLã®æ§‹é€ ã«ã¤ã„ã¦ç†è§£ãŒã‚ã‚‹ã¨æ¥½ãªã®ã§ä»¥ä¸‹è¨˜äº‹ã‚’å‚è€ƒã«ã—ã¦ã¿ã¦ãã ã•ã„ã€‚
https://8vivid.net/whats-url-scheme/
# ç°¡å˜ãªDeepLinkã‚¢ãƒ—ãƒªã®å‰ææ¡ä»¶

- ãã‚‚ãã‚‚ã‚¢ãƒ—ãƒªãŒã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã•ã‚Œã¦ã„ã‚‹ã€‚
- ãƒ•ã‚©ã‚¢ã‚°ãƒ©ã‚¦ãƒ³ãƒ‰ã§ã‚‚ãƒãƒƒã‚¯ã‚°ãƒ©ã‚¦ãƒ³ãƒ‰ã§ã‚‚å‹•ä½œã™ã‚‹ã€‚
- iOS&Androidã§å‹•ä½œç¢ºèªæ¸ˆã¿
- å‹•ä½œç¢ºèªã¯ã‚¨ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚¿ãƒ¼ã®ã¿

é–‹ç™ºç’°å¢ƒã§ã®DeepLinkå‹•ä½œç¢ºèªã¯ã¡ã¨é¢å€’ãªã®ã§ã‚¨ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚¿ãƒ¼ã®ã‚³ãƒãƒ³ãƒ‰ã‚’ä½¿ã£ã¦ã‚„ã£ã¦ã„ãã¾ã™ã€‚â†“å‚è€ƒè¨˜äº‹
https://qiita.com/Frog_kt/items/5f9e4dd1d2128173f60c

è©³ç´°æ°—ã«ãªã‚‹æ–¹ã¯ä¸€ç•ªæœ€å¾Œã«Githubãƒ¬ãƒã‚¸ãƒˆãƒªã®ãƒªãƒ³ã‚¯è²¼ã£ã¦ã„ã‚‹ã®ã§å‚è€ƒã«ã—ã¦ãã ã•ã„ã€‚
# ã•ã£ããå‹•ã‹ã—ã¦ã¿ã‚ˆã†
ä»Šå›ã¯ã‚ã‚‹ãƒªãƒ³ã‚¯ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ãŸæ™‚ã«ã‚¢ãƒ—ãƒªå´ã§ã‚­ãƒ£ãƒƒãƒã—ã€ã‚¢ãƒ—ãƒªãŒç«‹ã¡ä¸ŠãŒã£ã¦ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿éƒ¨åˆ†ãŒç”»é¢ã«è¡¨ç¤ºã•ã‚Œã‚‹ã‚¢ãƒ—ãƒªã‚’ä½œã£ã¦ã¿ã¾ã™ã€‚

ãƒªãƒ³ã‚¯ã¯```flutterUniversity://user/?name=matsumaru```ã§DeepLinkæ¤œè¨¼ã—ã¦ã¿ã¾ã™ã€‚

```flutterUniversity```ã®éƒ¨åˆ†ã¯ã‚¹ã‚­ãƒ¼ãƒ ã¨ã„ã£ã¦ã€ç›®å°ã«ãªã‚Šã¾ã™ã€‚ãªã‚“ã§ã‚‚ã„ã„ã§ã™ãŒã‚¢ãƒ—ãƒªåã«ã™ã‚‹ã®ãŒä¸€èˆ¬çš„ã‹ãªã¨æ€ã„ã¾ã™ã€‚
```user```ã®ã¨ã“ã‚ã‚‚é©å½“ã«ã¤ã‘ãŸã®ã§ãªã‚“ã§ã‚‚OKã§ã™ã€‚
```?name=matsumaru```ã®ã€Œ?ã€éƒ¨åˆ†ã¯ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ãƒ¼ã¨ã„ã£ã¦å¤‰æ•°ã‚’æŒ‡å®šã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚```?name=ma```ãªã©ä»»æ„ã§ã™ã€‚

ä»Šå›ã®ãƒªãƒ³ã‚¯ã®å ´åˆã‚¢ãƒ—ãƒªãŒç«‹ã¡ä¸ŠãŒã£ã¦ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿éƒ¨åˆ†ã®```matsumaru```ãŒç”»é¢ã«è¡¨ç¤ºã•ã‚Œã‚‹ã‚¢ãƒ—ãƒªã‚’ä½œã£ã¦ã¿ã¾ã™ã€‚


å‡ºæ¥ä¸ŠãŒã‚Šã¨ã—ã¦ã¯ã“ã‚“ãªæ„Ÿã˜ã§ã™ã€‚
| åˆæœŸç”»é¢ | ãƒªãƒ³ã‚¯ã‚­ãƒ£ãƒƒãƒå¾Œ |
| ---- | ---- | 
| ![](https://storage.googleapis.com/zenn-user-upload/aa21857718cc-20220311.png) | ![](https://storage.googleapis.com/zenn-user-upload/6f0eeb9201ae-20220311.png) | 

ã§ã¯è¨­å®šã—ã¦ã„ãã¾ã—ã‚‡ã†ã€‚

## iOSã®è¨­å®š
info.plistã«ä»¥ä¸‹ã‚’è¿½è¨˜ã—ã¦ã„ãã ã•ã„ã€‚
```xml
<dict>
	<!-- Deep Linksã€€ã“ã“ã‹ã‚‰ -->
    <key>FlutterDeepLinkingEnabled</key>
    <true/>
    <key>CFBundleURLTypes</key>
    <array>
        <dict>
        <key>CFBundleTypeRole</key>
        <string>Editor</string>
        <key>CFBundleURLSchemes</key>
        <array>
        <string>flutterUniversity</string> //flutterUniversityã¯ä»»æ„
        </array>
        </dict>
    </array>
	<!-- Deep Linksã€€ã“ã“ã¾ã§è¿½åŠ  -->
	//ä»¥ä¸‹ç•¥
```

## Androidã®è¨­å®š
AndroidManifest.xmlã®activityä»¥ä¸‹ã«è¿½è¨˜ã—ã¾ã™ã€‚
```xml
<manifest xmlns:android="http://schemas.android.com/apk/res/android"
    package="com.example.flutter_deeplink_demo">
   <application
        android:label="flutter_deeplink_demo"
        android:icon="@mipmap/ic_launcher">
        <activity
            android:name=".MainActivity"
            android:launchMode="singleTop"
            android:theme="@style/LaunchTheme"
            android:configChanges="orientation|keyboardHidden|keyboard|screenSize|smallestScreenSize|locale|layoutDirection|fontScale|screenLayout|density|uiMode"
            android:hardwareAccelerated="true"
            android:windowSoftInputMode="adjustResize">
            <!-- Deep Linksã€€ã“ã“ã‹ã‚‰ -->
            <intent-filter>
                <action android:name="android.intent.action.VIEW" />
                <category android:name="android.intent.category.DEFAULT" />
                <category android:name="android.intent.category.BROWSABLE" />
                <data android:scheme="flutterUniversity"  />  //flutterUniversityã¯ä»»æ„
            </intent-filter>
	    <!-- Deep Linksã€€ã“ã“ã¾ã§è¿½åŠ  -->
		//ä»¥ä¸‹ç•¥
```

## ã‚³ãƒ¼ãƒ‰å®Ÿè£…
main -> MyApp -> MyHomePageã¨ã„ã†åˆæœŸçŠ¶æ…‹ã®éšå±¤ã«ãªã£ã¦ã„ã¦MyHomePageã®å…¨æ–‡ã‚’ã®ã›ã¦ã„ã¾ã™ã€‚```linkStream.listen```ã‚’å®Ÿè¡Œã•ã›ã¦ãŠã‘ã°ã‚ã¨ã¯ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ãŒã„ã„æ„Ÿã˜ã«å‹•ã„ã¦ãã‚Œã‚‹ã®ã§ã‚ã£ã¡ã‚ƒç°¡å˜ã§ã™ã€‚
```dart
class MyHomePage extends StatefulWidget {
  @override
  State<MyHomePage> createState() => _MyHomePageState();
}

class _MyHomePageState extends State<MyHomePage> {
  StreamSubscription? _sub;
  String? catchLink;
  String? parameter;

  @override
  void initState() {
    super.initState();
    initUniLinks();
  }

  Future<void> initUniLinks() async {
    _sub = linkStream.listen((String? link) {
      //ã•ã£ãè¨­å®šã—ãŸã‚¹ã‚­ãƒ¼ãƒ ã‚’ã‚­ãƒ£ãƒƒãƒã—ã¦ã“ã“ãŒèµ°ã‚‹ã€‚
      catchLink = link;
      parameter = getQueryParameter(link);
      setState(() {});
    }, onError: (err) {
      print(err);
    });
  }

  String? getQueryParameter(String? link) {
    if (link == null) return null;
    final uri = Uri.parse(link);
    //flutterUniversity://user/?name=matsumaruã®matsumaruéƒ¨åˆ†ã‚’å–å¾—
    String? name = uri.queryParameters['name'];
    return name;
  }

  @override
  Widget build(BuildContext context) {
    return Scaffold(
      appBar: AppBar(),
      body: Center(
        child: Column(
          mainAxisAlignment: MainAxisAlignment.center,
          children: <Widget>[
            Text(
              'ãƒªãƒ³ã‚¯ï¼š$catchLink',
              style: Theme.of(context).textTheme.headline4,
            ),
            Text(
              'ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ãƒ¼ï¼š$parameter',
              style: Theme.of(context).textTheme.headline4,
            ),
          ],
        ),
      ),
    );
  }
}
```

ã“ã“ã¾ã§æ¥ã‚Œã°ã‚ã¨ã¯å‹•ä½œç¢ºèªã™ã‚‹ã ã‘ã§ã™ã€‚

## å‹•ä½œç¢ºèª
ä»Šå›ã¯ã‚¨ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚¿ãƒ¼ã®ã¿ã§ã®å‹•ä½œç¢ºèªã§ã™ã€‚ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã™ã‚Œã°è‰¯ã„ã ã‘ã§ã™ãŒã€iOSã¨Androidã§ç•°ãªã‚Šã¾ã™ã€‚

### iOS
```
xcrun simctl openurl booted flutterUniversity://user/?name=matsumaru
```

```flutterUniversity://user/?name=matsumaru```ã®éƒ¨åˆ†ã¯é©å®œç½®ãæ›ãˆã¦ãã ã•ã„ã€‚ã‚¢ãƒ—ãƒªã‚’ç«‹ã¡ä¸Šã’ãŸçŠ¶æ…‹ã§ä¸Šè¨˜ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã™ã‚Œã°å‹•ãã¯ãšã§ã™ã€‚

### Android
```
adb -e shell 'am start -W -a android.intent.action.VIEW -c android.intent.category.BROWSABLE -d "flutterUniversity://user/?name=matsumaru"'
```
Androidã®å ´åˆã¯å°‘ã—é•·ã„ã§ã™ãŒã€ä¸Šè¨˜ã®é€šã‚Šã§ã™ã€‚

å®Ÿæ©Ÿç¢ºèªã™ã‚‹å ´åˆã¯```adb -e```ã‚’```adb -d```ã«å¤‰ãˆã‚‹ã¨è‰¯ã•ãã†ã§ã™ã€‚
> The only USB connected device - adb -d shell '...'
> The only emulated device - adb -e shell '...'

[å‚è€ƒ](https://pub.dev/packages/uni_links)

ã“ã‚Œã§ç°¡å˜ãªDeepLinkã‚¢ãƒ—ãƒªã®ä½œæˆã¨å‹•ä½œç¢ºèªã¯å®Œäº†ã§ã™ã€‚

# ä»»æ„ã®classã§DeepLinkã‚’å—ã‘å–ã‚‹æ–¹æ³•
ä¸€æ—¦DeepLinkã®å®Ÿè£…ã¯ã§ãã¾ã—ãŸãŒã€è‰²ã‚“ãªclassã§DeepLinkã‚’å—ã‘å–ã‚ŠãŸã„ãƒ‹ãƒ¼ã‚ºã¯ã‚ã‚‹ã¨æ€ã„ã¾ã™ã€‚ãã“ã§ä»Šå›ã¯Mixinã‚’ä½¿ã£ã¦ã‚‚ã†å°‘ã—ã‚¹ãƒãƒ¼ãƒˆã«ã—ã¦ã¿ã‚ˆã†ã‹ãªã¨æ€ã„ã¾ã™ã€‚Mixinã«ã¤ã„ã¦ã¯ã“ã®è¨˜äº‹ãŒã‚ã‹ã‚Šã‚„ã™ã‹ã£ãŸã§ã™ã€‚
https://ntaoo.hatenablog.com/entry/2018/12/02/192827

å®Ÿè¡Œã‚³ãƒ¼ãƒ‰ã®é‡è¤‡ã‚’ã•ã‘ã‚‹ãŸã‚ã«MixinåŒ–ã—ã¦ä½¿ã„å›ã™ã£ã¦æ„Ÿã˜ã§ã™ã‹ã­ã€‚ä»Šå›ã®ã‚±ãƒ¼ã‚¹ã§ã„ã†ã¨ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã®ä¾å­˜é–¢ä¿‚ã‚‚æ¸›ã‚‰ã›ã‚‹ã®ã§ãã“ã‚‚è‰¯ã„ã‹ãªã¨æ€ã„ã¾ã™ã€‚

ã¨ã„ã†ã“ã¨ã§ä½œã£ã¦ã¿ã¾ã—ãŸã€‚å‚è€ƒã«ã—ãŸã®ã¯[ã“ã¡ã‚‰](https://github.com/mo-ah-dawood/fcm_config/blob/master/fcm_config/lib/src/fcm_notification_listener.dart)ã§ã™ã€‚[fcm_config](https://pub.dev/packages/fcm_config)ã¨ã„ã†ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã®å®Ÿè£…éƒ¨åˆ†ã‚’ãƒ‘ã‚¯ã£ã¦ã¾ã™ã€‚
```dart
mixin DeepLinkNotificationMixin<T extends StatefulWidget> on State<T> {
  StreamSubscription? _sub;
  @override
  void initState() {
    //DeepLinkã®ç›£è¦–
    _sub = uriLinkStream.listen(_onNewNotify);
    super.initState();
  }

  @override
  void dispose() {
    _sub?.cancel();
    super.dispose();
  }

  void onDeepLinkNotify(Uri? uri);

  void _onNewNotify(Uri? uri) {
    if (mounted) onDeepLinkNotify(uri);
  }
}

```
Mixinã‚’ä½¿ã£ã¦å…ˆç¨‹ã®MyHomePageã‚’æ›¸ãæ›ãˆã¦ã¿ã‚‹ã¨ä»¥ä¸‹ã®é€šã‚Šã§ã™ã€‚
```StatefulWidget```ã«```with DeepLinkNotificationMixin```ã—ã¦ã‚„ã‚Šã¾ã™ã€‚MyHomePageã¯uni_linksãƒ©ã‚¤ãƒ–ãƒ©ãƒªã«ä¾å­˜ã—ãªããªã£ãŸã®ã‚‚è‰¯ã•ãã†ã§ã™ã€‚
```dart
class MyHomePage extends StatefulWidget {
  @override
  State<MyHomePage> createState() => _MyHomePageState();
}

class _MyHomePageState extends State<MyHomePage>
    with DeepLinkNotificationMixin {
  String? catchLink;
  String? parameter;

  @override
  void initState() {
    super.initState();
  }

  //DeepLinkNotificationMixinã®onDeepLinkNotifyã‚’ç¶™æ‰¿ã—ã¦ã„ã‚‹ã€‚
  @override
  void onDeepLinkNotify(Uri? uri) {
    final link = uri.toString();
    catchLink = link;
    parameter = getQueryParameter(link);
    setState(() {});
  }

  String? getQueryParameter(String? link) {
    if (link == null) return null;
    final uri = Uri.parse(link);
    String? name = uri.queryParameters['name'];
    return name;
  }

  @override
  Widget build(BuildContext context) {
    return Scaffold(
      appBar: AppBar(),
      body: Center(
        child: Column(
          mainAxisAlignment: MainAxisAlignment.center,
          children: <Widget>[
            Text(
              'ãƒªãƒ³ã‚¯ï¼š$catchLink',
              style: Theme.of(context).textTheme.headline4,
            ),
            Text(
              'ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ãƒ¼ï¼š$parameter',
              style: Theme.of(context).textTheme.headline4,
            ),
          ],
        ),
      ),
    );
  }
}
```

ä»¥ä¸Šã§çµ‚ã‚ã‚Šã¾ã™ï¼

# ãƒ¬ãƒã‚¸ãƒˆãƒª
Githubã«ãƒ¬ãƒã‚¸ãƒˆãƒªä½œæˆã—ãŸã®ã§ã€å‚è€ƒã«ã—ã¦ã¿ã¦ãã ã•ã„ã€‚

https://github.com/MatsumaruTsuyoshi/flutter_deeplink_demo
