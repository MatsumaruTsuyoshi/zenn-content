---
title: "Flutterã®GoldenTestã§æ—¥æœ¬èªã‚’è¡¨ç¤ºã™ã‚‹"
emoji: "ğŸ§ª"
type: "tech"
topics:
  - "flutter"
  - "test"
  - "dart"
  - "golden"
published: true
published_at: "2021-10-22 19:47"
---

ä»Šå›ã¯[golden_toolkit](https://pub.dev/packages/golden_toolkit)ã‚’ç”¨ã„ãŸéš›ã®Goldenï¼ˆãƒã‚¹ã‚¿ãƒ¼ã®ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã‚·ãƒ§ãƒƒãƒˆï¼‰ã«æ—¥æœ¬èªã‚’è¡¨ç¤ºã—ã¦ã„ãæ–¹æ³•ã‚’ã¾ã¨ã‚ã¾ã—ãŸã€‚

| Before | After |
| ---- | ---- |
| ![](https://storage.googleapis.com/zenn-user-upload/f25c547750097d4ed0698042.png) | ![](https://storage.googleapis.com/zenn-user-upload/d81af61fcef0223ddda8bd55.png) |

# GoldenTestã¨ã¯
GoldenTestãªã«ãã‚Œï¼Ÿã£ã¦æ–¹ã‚„ã€ã¨ã‚Šãˆã‚ãšå‹•ã‹ã—ã¦ã¿ãŸã„ã¨ã„ã†æ–¹ã¯ä»¥å‰ã®è¨˜äº‹ã‚’å‚è€ƒã«ã—ã¦ãã ã•ã„ã€‚
https://zenn.dev/matsumaru/articles/c2bf8ec468cff8
https://zenn.dev/matsumaru/articles/44b4dc9927bb41

# å‰ææ¡ä»¶
[golden_toolkit](https://pub.dev/packages/golden_toolkit)ã‚’å°å…¥ã—ã¦ã„ã‚‹

ä»Šå›ã“ã®ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚’å‚è€ƒã«ã—ã¦ã„ã¾ã™ã€‚æ®‹å¿µãªã“ã¨ã«NullSafetyã§ã¯ãªã„ã®ã§ä½¿ãˆãªã„ãƒ»ãƒ»ãƒ»
https://pub.dev/packages/flutter_fonts_jp


# æ‰‹é †
1. pubspec.ymalã«assetsè¿½åŠ 
2. assetãƒ•ã‚©ãƒ«ãƒ€ã‚’ä½œæˆã—ã¦ãƒ•ã‚©ãƒ³ãƒˆï¼ˆtffï¼‰ã‚’è¿½åŠ 
3. ãƒ•ã‚©ãƒ³ãƒˆã‚’èª­ã¿è¾¼ã‚€é–¢æ•°ä½œæˆ
4. ãƒ†ã‚¹ãƒˆã‚³ãƒ¼ãƒ‰ä½œæˆ
5. ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ


# assetãƒ•ã‚©ãƒ«ãƒ€ã‚’ä½œæˆã—ã¦ãƒ•ã‚©ãƒ³ãƒˆï¼ˆtffï¼‰ã‚’è¿½åŠ 
ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®ç›´ä¸‹ã«assetãƒ•ã‚©ãƒ«ãƒ€ã‚’ä½œæˆã—ã¦ã€è¡¨ç¤ºã—ãŸã„ãƒ•ã‚©ãƒ³ãƒˆãƒ•ã‚¡ã‚¤ãƒ«ã‚’è¿½åŠ ã—ã¾ã™ã€‚
ä»Šå›ã¯NotoSansCJKjp-Regular.ttfã‚’ä½¿ã„ã¾ã—ãŸã€‚ãƒ•ã‚©ãƒ³ãƒˆãƒ•ã‚¡ã‚¤ãƒ«ã‚’ã‚°ã‚°ã‚Œã°è‰²ã€…ã§ã¦ãã¾ã™ã€‚
![](https://storage.googleapis.com/zenn-user-upload/4350610bd2d0ff6251627037.png)

# pubspec.ymalã«assetsè¿½åŠ 
ã‚ã¨ã§ãƒ•ã‚©ãƒ³ãƒˆã‚’èª­ã¿è¾¼ã‚ã‚‹ã‚ˆã†ã«è¿½è¨˜ã—ã¦ãŠãã¾ã™ã€‚
```yaml:pubspec.yaml
flutter:
  assets:
    - asset/
```
# ãƒ•ã‚©ãƒ³ãƒˆã‚’èª­ã¿è¾¼ã‚€é–¢æ•°ä½œæˆ
ã“ã‚Œã§ãƒ•ã‚©ãƒ³ãƒˆã‚’èª­ã¿è¾¼ã¿ã¾ã™ã€‚
```dart
Future<void> loadJapaneseFont() async {
  TestWidgetsFlutterBinding.ensureInitialized();
  final binary = rootBundle.load('asset/NotoSansCJKjp-Regular.ttf');
  final loader = FontLoader('Roboto')..addFont(binary);
  await loader.load();
}
```

# ãƒ†ã‚¹ãƒˆã‚³ãƒ¼ãƒ‰ä½œæˆ
å®Ÿéš›ã«ãƒ†ã‚¹ãƒˆãŒèµ°ã‚‹å‰ã«ãƒ•ã‚©ãƒ³ãƒˆèª­ã¿è¾¼ã¿ã‚’å®Ÿè¡Œã—ã¦ã‚„ã‚Œã°ã€ã¡ã‚ƒã‚“ã¨æ—¥æœ¬èªè¡¨ç¤ºã—ã¦ãã‚Œã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚
```dart
Future<void> loadJapaneseFont() async {
  TestWidgetsFlutterBinding.ensureInitialized();
  final binary = rootBundle.load('asset/NotoSansCJKjp-Regular.ttf');
  final loader = FontLoader('Roboto')..addFont(binary);
  await loader.load();
}

void main() {
  testGoldens('firstPage', (WidgetTester tester) async {
    //ã“ã“ã§ãƒ•ã‚©ãƒ³ãƒˆèª­ã¿è¾¼ã¿ã‚’å®Ÿè¡Œã™ã‚‹
    await loadJapaneseFont();
    final builder = DeviceBuilder()
      ..overrideDevicesForAllScenarios(devices: [
        Device.iphone11,
      ])
      ..addScenario(
        widget: FirstPage(),
        name: 'default page',
      );
    await tester.pumpDeviceBuilder(builder);
    await screenMatchesGolden(tester, 'firstPage');
  });
}
```
# ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ
ã‚ã¨ã¯ã‚¿ãƒ¼ãƒŸãƒŠãƒ«ã§ä»¥ä¸‹ã‚³ãƒãƒ³ãƒ‰ã‚’å©ã„ãŸã‚‰æ—¥æœ¬èªãŒè¡¨ç¤ºã•ã‚Œã¦ã„ã‚‹ã¯ãšï¼
```
flutter test --update-goldens
```

| Before | After |
| ---- | ---- |
| ![](https://storage.googleapis.com/zenn-user-upload/f25c547750097d4ed0698042.png) | ![](https://storage.googleapis.com/zenn-user-upload/d81af61fcef0223ddda8bd55.png) |

# çµ‚ã‚ã‚Šã«
æŒ¯ã‚Šè¿”ã£ã¦ã¿ã‚‹ã¨ã‚ã£ã¡ã‚ƒç°¡å˜ã ã‘ã©ã€ã™ã”ã„æ™‚é–“ãŒæ›ã‹ã£ãŸã®ã§å‚è€ƒã«ãªã‚Œã°å¹¸ã„ã§ã™ã€‚
