---
title: "KeyPathã¨CasePathsã‚’ä¸å¯§ã«è§£èª¬ã—ã¦ã¿ã‚‹"
emoji: "ğŸ‘Œ"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: ["swift"]
published: false
---


## ãƒ¢ãƒãƒ™ãƒ¼ã‚·ãƒ§ãƒ³


```swift
enum UserAction {
  case home(String)
  case settings(Int)
}
```

UserActionã¨ã„ã†enumãŒã‚ã£ãŸã¨ãã«ã€[UserAction]ã‹ã‚‰UserAction.homeã®indexãŒæ¬²ã—ã„ã‚±ãƒ¼ã‚¹ãŒã‚ã‚‹ã¨ã—ã¾ã™ã€‚
ãã®ã¨ãã«ä»¥ä¸‹ã®ã‚ˆã†ã«å®Ÿè£…ã—ã¦ã¾ã—ãŸã€‚

```swift
let actions: [UserAction] = [.home("home"), .settings(1)]
guard let index = actions.firstIndex(where: {
    if case .home = $0 { return true }
    return false
}) else {
    return
}
```

ãã—ãŸã‚‰ã€CasePathsãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚’ä½¿ãˆã°ä»¥ä¸‹ã®ã‚ˆã†ã«ã™ã£ãã‚Šã‚·ãƒ³ãƒ—ãƒ«ã«æ›¸ã‘ã‚‹ã¨ãƒ¬ãƒ“ãƒ¥ãƒ¼ã§ã‚¢ãƒ‰ãƒã‚¤ã‚¹ã‚’ã‚‚ã‚‰ã„ã€å­¦ã¼ã†ã¨ã—ãŸã®ãŒã“ã®è¨˜äº‹ã®ãã£ã‹ã‘ã«ãªã‚Šã¾ã™ã€‚

```swift
guard let index = actions.firstIndex(where: {
    $0[case: \.home] != nil
}) else {
    return
}
```

ã¾ãŸã€CasePathsã‚’ç†è§£ã™ã‚‹ã«ã¯å¿…ãšKeyPathã‚‚å¿…è¦ã«ãªã‚‹ã®ã§ã€é †ã‚’è¿½ã£ã¦èª¬æ˜ã—ã¦ã„ã“ã†ã¨æ€ã„ã¾ã™ã€‚

## KeyPathã¨ã¯

ã‚ã‚‹å‹ã®ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã®å€¤ã«ã«ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹å‚ç…§ï¼ˆãƒ‘ã‚¹ï¼‰ã§ã™ã€‚
https://developer.apple.com/documentation/swift/keypath

Key,valueã®é–¢ä¿‚ã«ãªã£ã¦ã„ã‚‹ã‚ˆã†ãªã‚‚ã®ã‚’å‹å®‰å…¨ã«valueã®å€¤ã‚’å–å¾—ã§ãã‚‹ã‚ã‘ã§ã™ã€‚

### KeyPathã®æ­´å²çš„èƒŒæ™¯

#### åˆæœŸã®ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã‚¢ã‚¯ã‚»ã‚¹ (Objective-C)
SwiftãŒç™»å ´ã™ã‚‹ä»¥å‰ã€Objective-Cã®KVC (Key-Value Coding)ãŒãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã¸ã®é–“æ¥çš„ãªã‚¢ã‚¯ã‚»ã‚¹ã‚’ã‚µãƒãƒ¼ãƒˆã—ã¦ã„ã¾ã—ãŸã€‚KVCã§ã¯æ–‡å­—åˆ—ã§ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£åã‚’æŒ‡å®šã—ã¦å€¤ã«ã‚¢ã‚¯ã‚»ã‚¹ã§ãã¾ã—ãŸãŒã€æ–‡å­—åˆ—ãƒ™ãƒ¼ã‚¹ã§ã‚ã‚‹ãŸã‚ã€é–“é•ã£ãŸãƒ—ãƒ­ãƒ‘ãƒ†ã‚£åã‚’æŒ‡å®šã—ã¦ã‚‚ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«æ™‚ã«ã¯ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã›ãšã€å®Ÿè¡Œæ™‚ã«ã‚¯ãƒ©ãƒƒã‚·ãƒ¥ã™ã‚‹å±é™ºæ€§ãŒã‚ã‚Šã¾ã—ãŸã€‚

#### Swiftã®ç™»å ´ã¨å‹å®‰å…¨æ€§
Swiftã¯å‹å®‰å…¨æ€§ã‚’å¼·ãé‡è¦–ã—ã¦ãŠã‚Šã€ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã‚¢ã‚¯ã‚»ã‚¹ã«ã‚‚å‹å®‰å…¨ãªã‚¢ãƒ—ãƒ­ãƒ¼ãƒãŒæ±‚ã‚ã‚‰ã‚Œã¾ã—ãŸã€‚KVCã®ã‚ˆã†ãªå‹•çš„ã‚¢ã‚¯ã‚»ã‚¹ã§ã¯ãªãã€é™çš„ã«å‹ã‚’ä¿è¨¼ã§ãã‚‹ãƒ¡ã‚«ãƒ‹ã‚ºãƒ ãŒå¿…è¦ã ã£ãŸãŸã‚ã€Key Pathã®å°å…¥ãŒæ¤œè¨ã•ã‚Œã¾ã—ãŸã€‚

#### Key Pathã®å°å…¥ (Swift 4)
Swift 4ã§Key PathãŒå°å…¥ã•ã‚Œã€æ–‡å­—åˆ—ãƒ™ãƒ¼ã‚¹ã®ã‚¢ã‚¯ã‚»ã‚¹ã®ä»£ã‚ã‚Šã«ã€å‹å®‰å…¨ã§ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«æ™‚ã«ãƒã‚§ãƒƒã‚¯ã•ã‚Œã‚‹Key PathãŒæä¾›ã•ã‚Œã¾ã—ãŸã€‚ã“ã‚Œã«ã‚ˆã‚Šã€ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã«å®‰å…¨ã«ã‚¢ã‚¯ã‚»ã‚¹ã—ã€ã‹ã¤ã‚³ãƒ¼ãƒ‰ã®ãƒªãƒ•ã‚¡ã‚¯ã‚¿ãƒªãƒ³ã‚°ã‚„å¤‰æ›´ã«ã‚‚å¼·ããªã‚Šã¾ã—ãŸã€‚

### KeyPathã®ç¨®é¡

| Key Path ç¨®é¡               | ç‰¹å¾´                                                                 | ã‚¢ã‚¯ã‚»ã‚¹ã®ç¨®é¡           | å‹æ¶ˆå»    | é©ç”¨å¯¾è±¡         | ç”¨é€”                                                                            |
|-----------------------------|----------------------------------------------------------------------|--------------------------|-----------|------------------|---------------------------------------------------------------------------------|
| AnyKeyPath                   | å®Œå…¨ã«å‹æ¶ˆå»ã•ã‚ŒãŸKey Pathã€‚å…·ä½“çš„ãªå‹æƒ…å ±ã¯ä¿æŒã—ãªã„ã€‚              | èª­ã¿å–ã‚Šã®ã¿             | å®Œå…¨æ¶ˆå»  | æ§‹é€ ä½“/ã‚¯ãƒ©ã‚¹    | å‹æƒ…å ±ãŒä¸è¦ãªå ´åˆã€ã¾ãŸã¯Key Pathè‡ªä½“ã‚’æ“ä½œã™ã‚‹ãŸã‚ã«ä½¿ç”¨ã€‚                      |
| PartialKeyPath               | å‹ãŒéƒ¨åˆ†çš„ã«æ¶ˆå»ã•ã‚ŒãŸèª­ã¿å–ã‚Šå°‚ç”¨Key Pathã€‚ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã®å‹ãŒä¸æ˜ãªå ´åˆã§ã‚‚ã‚¢ã‚¯ã‚»ã‚¹å¯èƒ½ã€‚ | èª­ã¿å–ã‚Šã®ã¿             | éƒ¨åˆ†çš„    | æ§‹é€ ä½“/ã‚¯ãƒ©ã‚¹    | ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã®å‹ãŒæœªçŸ¥ã®ã¨ãã«ä½¿ã‚ã‚Œã‚‹ã€‚                                            |
| KeyPath                      | èª­ã¿å–ã‚Šå°‚ç”¨ã®Key Pathã€‚å‹ã®ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã«ã‚¢ã‚¯ã‚»ã‚¹å¯èƒ½ã€‚                | èª­ã¿å–ã‚Šã®ã¿             | ãªã—      | æ§‹é€ ä½“/ã‚¯ãƒ©ã‚¹    | ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã®å€¤ã‚’å®‰å…¨ã«èª­ã¿å–ã‚‹å ´åˆã«ä½¿ç”¨ã€‚                                       |
| WritableKeyPath              | èª­ã¿æ›¸ãå¯èƒ½ãªKey Pathã€‚æ§‹é€ ä½“ã‚„ã‚¯ãƒ©ã‚¹ã®ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã«å¯¾ã—ã¦å€¤ã‚’å¤‰æ›´ã§ãã‚‹ã€‚ | èª­ã¿å–ã‚Šãƒ»æ›¸ãè¾¼ã¿       | ãªã—      | æ§‹é€ ä½“/ã‚¯ãƒ©ã‚¹    | ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã®å€¤ã‚’å¤‰æ›´ã™ã‚‹å¿…è¦ãŒã‚ã‚‹å ´åˆã«ä½¿ç”¨ã€‚                                    |
| ReferenceWritableKeyPath      | ã‚¯ãƒ©ã‚¹å°‚ç”¨ã®èª­ã¿æ›¸ãå¯èƒ½ãªKey Pathã€‚å‚ç…§å‹ã®ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã«å¯¾ã—ã¦èª­ã¿æ›¸ããŒå¯èƒ½ã€‚ | èª­ã¿å–ã‚Šãƒ»æ›¸ãè¾¼ã¿       | ãªã—      | ã‚¯ãƒ©ã‚¹           | ã‚¯ãƒ©ã‚¹ã®ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã«å¯¾ã—ã¦èª­ã¿æ›¸ãå¯èƒ½ãªå ´åˆã«ä½¿ç”¨ã€‚                             |


é †ã«è¡¨ã®ä¸Šã®ã‚‚ã®ã‚’ç¶™æ‰¿ã—ã¦ã„ã£ã¦ã„ã¾ã™ã€‚

## KeyPathã®è¡¨ç¾æ–¹æ³•

ã§ã¯å…·ä½“çš„ã«ã©ã†æ‰±ã†ã®ã‹ã“ã“ã§ç´¹ä»‹ã—ã¦ã„ãã¾ã™ã€‚

ã»ã¨ã‚“ã©ã“ã¡ã‚‰ã®å…¬å¼ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’å‚è€ƒã«ã—ã¦ã„ã¾ã™ã€‚
https://docs.swift.org/swift-book/documentation/the-swift-programming-language/expressions/#Key-Path-Expression

ä»¥ä¸‹ã€key pathã‚’ä½¿ã£ã¦å€¤ã‚’å–å¾—ã™ã‚‹æ–¹æ³•ã«ãªã‚Šã¾ã™ã€‚

```swift
struct SomeStructure {
    var someValue: Int
}

let s = SomeStructure(someValue: 12)
let pathToProperty = \SomeStructure.someValue
let value = s[keyPath: pathToProperty]
// value is 12
```

å‹æŒ‡å®šã—ã¦ã„ã‚Œã°Â Â `\SomeClass.someProperty`ã®ä»£ã‚ã‚Šã«`\.someProperty`ã¨è¡¨ç¾ã™ã‚‹ã“ã¨ã‚‚ã§ãã¾ã™ã€‚

ã‚µãƒ—ã‚¹ã‚¯ãƒªãƒ—ãƒˆã¨ã—ã¦ã‚‚key pathãŒä½¿ãˆã¾ã™ã€‚
```swift
let greetings = ["hello", "hola", "bonjour", "ì•ˆë…•"]
let myGreeting = greetings[keyPath: \[String].[1]]
// myGreeting is 'hola'
```

Key pathã‚’ã†ã¾ãä½¿ã†ã“ã¨ã§ãƒã‚¹ãƒˆã•ã‚ŒãŸå€¤ã«ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™

```swift
let interestingNumbers = ["prime": [2, 3, 5, 7, 11, 13, 17],
                          "triangular": [1, 3, 6, 10, 15, 21, 28],
                          "hexagonal": [1, 6, 15, 28, 45, 66, 91]]
print(interestingNumbers[keyPath: \[String: [Int]].["prime"]] as Any)
// Prints "Optional([2, 3, 5, 7, 11, 13, 17])"
print(interestingNumbers[keyPath: \[String: [Int]].["prime"]![0]])
// Prints "2"
print(interestingNumbers[keyPath: \[String: [Int]].["hexagonal"]!.count])
// Prints "7"
print(interestingNumbers[keyPath: \[String: [Int]].["hexagonal"]!.count.bitWidth]) // bitWidthã¯ï¼’é€²æ•°
// Prints "64"
```

mapã®ä¸­ã§ã‚‚KeyPathã¯ä½¿ãˆã¾ã™ã€‚

```swift
struct Task {
    var description: String
    var completed: Bool
}
var toDoList = [
    Task(description: "Practice ping-pong.", completed: false),
    Task(description: "Buy a pirate costume.", completed: true),
    Task(description: "Visit Boston in the Fall.", completed: false),
]

// åŒã˜çµæœã«ãªã‚Šã¾ã™ã€‚$0ãŒãªã„åˆ†å°‘ã—ã‚·ãƒ³ãƒ—ãƒ«ã«è¦‹ãˆã‚‹
let descriptions = toDoList.filter(\.completed).map(\.description)
let descriptions2 = toDoList.filter { $0.completed }.map { $0.description }
```

## KeyPathã®ä½¿ã„æ‰€

KeyPahtã®è¡¨ç¾æ–¹æ³•ãŒåˆ†ã‹ã£ãŸã¨ã“ã‚ã§ã€å…·ä½“çš„ãªä½¿ã„é“ã‚’ã“ã¡ã‚‰ã®`Person`æ§‹é€ ä½“ã‚’ä½¿ã£ã¦è€ƒãˆã¦ã¿ã¾ã™ã€‚

```swift
class Person {
    var name: String
    var age: Int

    init(name: String, age: Int) {
        self.name = name
        self.age = age
    }
}

let people = [
    Person(name: "Alice", age: 30),
    Person(name: "Bob", age: 24),
    Person(name: "Charlie", age: 28)
]
```
### KeyPathã‚’ä½¿ã£ãŸæ±ç”¨ä¾‹
ä¸Šè¨˜ã®ã‚ˆã†ãªæ§‹é€ ä½“ã¨ãã®é…åˆ—ãŒã‚ã£ãŸã¨ã—ã¦ã€ãã®æ§‹é€ ä½“ã®ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã‚’å–å¾—ã—ãŸã„ã‚±ãƒ¼ã‚¹ã‚’è€ƒãˆã¦ã¿ã¾ã™ã€‚
ãã®å ´åˆã€extractPropertyã®ã‚ˆã†ã«KeyPathã‚’å¼•æ•°ã«ã™ã‚‹ã“ã¨ã§æ±ç”¨çš„ãªé–¢æ•°ã¨ã—ã¦æ‰±ã†ã“ã¨ãŒã§ãã¾ã™ã€‚

```swift
// æ±ç”¨çš„ã«ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã‚’æŠ½å‡ºã™ã‚‹é–¢æ•°
func extractProperty<T, U>(from array: [T], using keyPath: KeyPath<T, U>) -> [U] {
    return array.map { $0[keyPath: keyPath] }
}

// åå‰ãƒªã‚¹ãƒˆã‚’æŠ½å‡º
let names = extractProperty(from: people, using: \.name)
print(names) // ["Alice", "Bob", "Charlie"]

// å¹´é½¢ãƒªã‚¹ãƒˆã‚’æŠ½å‡º
let ages = extractProperty(from: people, using: \.age)
print(ages) // [30, 24, 28]
```

### KeyPathã‚’ä½¿ã‚ãªã„ä¾‹
ã‚‚ã—KeyPathã‚’ä½¿ã‚ãªã‹ã£ãŸã‚‰ä»¥ä¸‹ã®ã‚ˆã†ãªå®Ÿè£…ã«ãªã‚‹ã¨æ€ã„ã¾ã™ã€‚

```swift
// åå‰ãƒªã‚¹ãƒˆã‚’æŠ½å‡ºã™ã‚‹é–¢æ•°
func extractNames(from array: [Person]) -> [String] {
    return array.map { $0.name }
}

// å¹´é½¢ãƒªã‚¹ãƒˆã‚’æŠ½å‡ºã™ã‚‹é–¢æ•°
func extractAges(from array: [Person]) -> [Int] {
    return array.map { $0.age }
}

let namesWithoutKeyPath = extractNames(from: people)
print(namesWithoutKeyPath) // ["Alice", "Bob", "Charlie"]

let agesWithoutKeyPath = extractAges(from: people)
print(agesWithoutKeyPath) // [30, 24, 28]
```

KeyPathã‚’ä½¿ã£ãŸæ–¹ãŒæ±ç”¨æ€§ãŒã‚ã£ã¦è‰¯ã•ãã†ã§ã™ã€‚

## KeyPathã®ç‰¹å¾´

ã“ã“ã¾ã§KeyPathã‚’èª¬æ˜ã—ã¦ãã¾ã—ãŸãŒã€ã“ã“ã§æ•´ç†ã—ãŸã„ã¨æ€ã„ã¾ã™ã€‚

### KeyPathã®ãƒ¡ãƒªãƒƒãƒˆ

- ç°¡æ½”ã«è¡¨ç¾ã§ãã‚‹ã“ã¨
- å†åˆ©ç”¨ã§ãã‚‹ã“ã¨

### KeyPathã®ãƒ‡ãƒ¡ãƒªãƒƒãƒˆ

- enumã§ä½¿ãˆãªã„

ãªã‚“ã¨ã¯enumã§KeyPathã‚ã‚Šã¾ã›ã‚“ã€‚

```swift
enum UserAction {
  case home(String)
  case settings(Int)
}

\UserAction.home  // Â key path cannot refer to static member 'home'
```

ã¾ãŸUserAction.homeã®å€¤ãŒæ¬²ã—ã‘ã‚Œã°`if case .home`ãªã©ã®å‡¦ç†ãŒå¿…è¦ã«ãªã‚Šã¾ã™ã€‚ã¤ã¾ã‚Šå†’é ­ã§åƒ•ãŒæ›¸ã„ãŸå®Ÿè£…ã«ãªã‚Šã¾ã™ã€‚
ãã“ã§å‡ºã¦ãã‚‹ã®ãŒCasePathsãƒ©ã‚¤ãƒ–ãƒ©ãƒªãªã‚ã‘ã§ã™ã€‚


## CasePathsã«ã¤ã„ã¦

> Case paths extends the key path hierarchy to enum cases.

https://github.com/pointfreeco/swift-case-paths

Case pathsã¯åˆ—æŒ™å‹ã®ã‚±ãƒ¼ã‚¹ã®Key pathã®éšå±¤æ§‹é€ ã‚’æ‹¡å¼µã—ã¦ãã‚Œã‚‹ã‚‚ã®ã«ãªã‚Šã¾ã™ã€‚
TCAãªã©ã‚’é–‹ç™ºã—ã¦ã„ã‚‹pointfreeã§é–‹ç™ºã•ã‚Œã¦ã„ã‚‹ã‚‚ã®ã«ãªã‚Šã¾ã™ã€‚

KeyPathã§ã¯enumã‚’æ‰±ãˆã¾ã›ã‚“ã§ã—ãŸãŒã€CasePathsãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚’ä½¿ã†ã“ã¨ã§ä½¿ãˆã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚

```swift
@CasePathable
enum UserAction {
  case home(String)
  case settings(Int)
}

\UserAction.Cases.home      // CaseKeyPath<UserAction, String>
\UserAction.Cases.settings  // CaseKeyPath<UserAction, Int>
```

:::message
ã‚ã£ã¡ã‚ƒç°¡å˜
:::

ã»ã¼ã»ã¼KeyPathã¨åŒã˜ã‚ˆã†ã«æ‰±ãˆã‚‹ã®ã§ä¾¿åˆ©ãªã‚ã‘ã§ã™ã€‚

### CasePathsã®è¡¨ç¾

ã“ã“ã§ã¯CasePathsã®è¡¨ç¾ã¨KeyPathã¨ã®æ¯”è¼ƒã‚’ã—ã¦ã„ãã¾ã™ã€‚
ã“ã“ã‚’è¦‹ã‚Œã°ä½¿ã„æ–¹ãŒåˆ†ã‹ã‚‹ã‚ˆã†ã«ãªã‚‹ã¯ãšã§ã™ã€‚

```swift
user[keyPath: \User.name] = "Blob"
user[keyPath: \.name]  // "Blob"

userAction[case: \UserAction.Cases.home] = "home"
userAction[case: \.home]  // Optional("home")
```

ä»¥ä¸‹ã®ã‚ˆã†ãªä½¿ã„æ–¹ã‚‚ã§ãã¾ã™ã€‚

```swift
let userActionToHome = \UserAction.Cases.home
userAction.is(\.home)      // true
userAction.is(\.settings)  // false

let actions: [UserAction] = [â€¦]
let homeActionsCount = actions.count(where: { $0.is(\.home) })
```

modifyã‚’ä½¿ã£ã¦Resultã®Successã®å€¤ã‚’å¤‰æ›´ã™ã‚‹ã“ã¨ã‚‚ã§ãã‚‹ã¾ã™ã€‚ï¼ˆã“ã‚Œã„ã¤ä½¿ã†ã‚“ï¼ŸğŸ¤”ï¼‰
```swift
var result = Result<String, Error>.success("Blob")
result.modify(\.success) {
  $0 += ", Jr."
}
result  // Result.success("Blob, Jr.")
```

Key pathã¨åŒæ§˜ã«pathã®appendã‚‚ã§ãã¾ã™ã€‚

```swift
let highScoreToUser = \HighScore.user
let userToName = \User.name
let highScoreToUserName = highScoreToUser.append(path: userToName)
// WritableKeyPath<HighScore, String>

let appActionToUser = \AppAction.Cases.user
let userActionToHome = \UserAction.Cases.home
let appActionToHome = appActionToUser.append(path: userActionToHome)
// CaseKeyPath<AppAction, HomeAction>
```

Swift5.2ã‹ã‚‰key pathã‚’ç›´æ¥mapãªã©ã«ã‚‚æ¸¡ã›ã‚‹ã‚ˆã†ã«ãªã£ãŸã‚‚ã®ã¯case pathã§ã‚‚åŒã˜ã‚ˆã†ã«ä½¿ãˆã¾ã™ã€‚

```swift
let userActions: [UserAction] = [.home(.onAppear), .settings(.purchaseButtonTapped)]
userActions.compactMap(\.home)  // [HomeAction.onAppear]
```

@dynamicMemberLookupãƒã‚¯ãƒ­ã‚’ä½¿ãˆã°ã€ãƒ‰ãƒƒãƒˆè¨˜æ³•ã§å‹•çš„ã«ã‚¢ã‚¯ã‚»ã‚¹ã§ãã¾ã™ã€‚

```swift
@CasePathable
@dynamicMemberLookup
enum UserAction {
  case home(HomeAction)
  case settings(SettingsAction)
}

let userAction: UserAction = .home(.onAppear)
userAction.home      // Optional(HomeAction.onAppear)
userAction.settings  // nil
```

:::message
@dynamicMemberLookupã¨ã¯
ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«æ™‚ã«å­˜åœ¨ã—ãªã„ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã«å¯¾ã—ã¦ãƒ‰ãƒƒãƒˆè¨˜æ³•ã§ã‚¢ã‚¯ã‚»ã‚¹ã§ãã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚
Pythonãªã©ã®å‹•çš„è¨€èªãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚’ä½¿ã†ã¨ãã«ç”¨ã„ã‚‰ã‚ŒãŸã‚Šã™ã‚‹ã‚‰ã—ã„ã§ã™ã€‚
:::

### @CasePathableã®ä»•çµ„ã¿

ã•ã¦ã€ã“ã“ã¾ã§ã¯å…¬å¼ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã®å†…å®¹ã‚’ç´¹ä»‹ã—ã¦ãã¾ã—ãŸãŒã€ã“ã“ã‹ã‚‰ã¯ã‚‚ã†å°‘ã—æ·±ã¼ã£ã¦ã„ããŸã„ã¨è€ƒãˆã¦ã„ã¾ã™ã€‚

@CasePathableãƒã‚¯ãƒ­ã‚’ä½¿ãˆã°enumã§ã‚‚KeyPathã®ã‚ˆã†ãªä½¿ã„æ–¹ãŒã§ãã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã—ãŸãŒã€@CasePathableãƒã‚¯ãƒ­ãŒã©ã‚“ãªã‚³ãƒ¼ãƒ‰ã‚’ç”Ÿæˆã—ã€ã©ã‚“ãªå‡¦ç†ã—ã¦ãã‚Œã¦ã„ã‚‹ã®ã‹æ°—ã«ãªã£ãŸã®ã§èª¿ã¹ã¦ã¿ã¾ã—ãŸã€‚

ãƒã‚¯ãƒ­ã«ã¤ã„ã¦ã®èª¬æ˜ã¯å‰²æ„›ã—ã¾ã™ãŒã€ã–ã£ãã‚ŠæŠŠæ¡ã™ã‚‹ã®ã«ä»¥ä¸‹è¨˜äº‹ãŒå‚è€ƒã«ãªã‚‹ã¨æ€ã„ã¾ã™ã€‚
https://zenn.dev/iceman/articles/4613ef478c9691

#### CasePathableãƒã‚¯ãƒ­ã§ç”Ÿæˆã•ã‚Œã‚‹ã‚³ãƒ¼ãƒ‰

ãƒã‚¯ãƒ­ã§ç”Ÿæˆã•ã‚Œã‚‹ã‚³ãƒ¼ãƒ‰ã¯Xcode(ãƒã‚¯ãƒ­éƒ¨åˆ†ã§å³ã‚¯ãƒªãƒƒã‚¯ -> Expand Macro)ã§è¡¨ç¤ºã§ãã¾ã™ã€‚
ä»¥ä¸‹ã€ã‚³ãƒ¡ãƒ³ãƒˆã§å›²ã£ãŸéƒ¨åˆ†ãŒãƒã‚¯ãƒ­ã§ç”Ÿæˆã•ã‚ŒãŸã‚³ãƒ¼ãƒ‰ã«ãªã‚Šã¾ã™ã€‚

caseã”ã¨ã«ãƒœã‚¤ãƒ©ãƒ¼ãƒ—ãƒ¬ãƒ¼ãƒˆãŒç”Ÿæˆã•ã‚Œã¦ãŠã‚Šã€embedã¯set,extractã¯getã®å½¹å‰²ã‚’ã—ã¦ã„ã¾ã™ã€‚
ãŸã ã—ã€ã“ã‚Œã ã‘ã§ã¯ã„ã¾ã„ã¡å…¨å®¹ãŒåˆ†ã‹ã‚Šã¾ã›ã‚“ã€‚ã¨ãã«`extension UserAction: CasePaths.CasePathable`ã§ã¯ã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ãƒˆã®å‡¦ç†ãŒãªã•ã‚Œã¦ã„ã‚‹ã‚“ã§ã™ãŒã€ãã“ã‚‚çŸ¥ã‚ŠãŸã„ã§ã™ã­ã€‚
ã¨ã„ã†ã“ã¨ã§ã€CasePathableãƒã‚¯ãƒ­ã‚’ä½¿ã‚ãšã«enumã§KeyPathãŒä½¿ãˆã‚‹ã‚ˆã†ã«æ‰‹å…ƒã§å®Ÿè£…ã—ã¦ç†è§£ã‚’æ·±ã‚ã¦ã„ã“ã†ã¨æ€ã„ã¾ã™ã€‚

```swift
@CasePathable
enum UserAction {
  case home(String)
  case settings(Int)
    // Macroã§ç”Ÿæˆã•ã‚ŒãŸå®Ÿè£…
    public struct AllCasePaths {
        public var home: CasePaths.AnyCasePath<UserAction, String> {
            CasePaths.AnyCasePath<UserAction, String>(
                embed: UserAction.home,
                extract: {
                    guard case let .home(v0) = $0 else {
                        return nil
                    }
                    return v0
                }
            )
        }
        public var settings: CasePaths.AnyCasePath<UserAction, Int> {
            CasePaths.AnyCasePath<UserAction, Int>(
                embed: UserAction.settings,
                extract: {
                    guard case let .settings(v0) = $0 else {
                        return nil
                    }
                    return v0
                }
            )
        }
    }
    public static var allCasePaths: AllCasePaths { AllCasePaths() }
    // Macroã§ç”Ÿæˆã•ã‚ŒãŸå®Ÿè£…
}

// Macroã§ç”Ÿæˆã•ã‚ŒãŸå®Ÿè£…
extension UserAction: CasePaths.CasePathable {
}
// Macroã§ç”Ÿæˆã•ã‚ŒãŸå®Ÿè£…
```

### CasePathableã‚’è‡ªåŠ›ã§å®Ÿè£…ã—ã¦ã¿ã‚‹

ã“ã“ã§ã®ç›®æ¨™ã¯CasePathableãƒã‚¯ãƒ­ã‚’ä½¿ã‚ãšã«ã€KeyPathã‚’ä½¿ã£ã¦enumã®å€¤ã‚’å–å¾—ã™ã‚‹ã“ã¨ã§ã™ã€‚
ã•ãã»ã©ã®UserActionã¨åŒã˜æ§‹é€ ã§UserActionManualãŒã‚ã‚‹ã¨ã—ã¾ã™ã€‚

```swift
enum UserActionManual {
  case home(String)
  case settings(Int)
}
```

å½“ãŸã‚Šå‰ã§ã™ãŒã€ä»Šã®ã¾ã¾ã§ä»¥ä¸‹ã®ã‚ˆã†ã«UserActionManualã®å€¤ã‚’å–å¾—ã—ã‚ˆã†ã¨ã—ãŸã‚‰ã‚¨ãƒ©ãƒ¼ãŒã§ã¾ã™ã­ã€‚ã“ã‚Œã‚’è§£æ±ºã—ã¦ã„ãã¾ã™ã€‚

```swift
let manualAction: UserActionManual = .home("manual home")
let manualUserActionHomeValue = manualAction[case: \.home] // ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«ã‚¨ãƒ©ãƒ¼
```


ã§ã¯ãã®å®Ÿè£…ã«ãªã‚Šã¾ã™ã€‚ã‚³ãƒ¼ãƒ‰ä¸Šã«ã‚³ãƒ¡ãƒ³ãƒˆã‚’è¨˜è¼‰ã—ã¦ã„ãã¾ã™ã€‚
```swift
// emebed, extractã‚’æŒã£ãŸæ§‹é€ ä½“ã‚’ç”¨æ„ã™ã‚‹ã€‚CathPathsã®AnyCasePathã‚’å‚è€ƒã«ã—ã¦ã„ã‚‹
struct AnyCasePathhManual<Enum, Value> {
    let embed: (Value) -> Enum
    let extract: (Enum) -> Value?
}

enum UserActionManual {
  case home(String)
  case settings(Int)
    // Macroã§ç”Ÿæˆã•ã‚ŒãŸå®Ÿè£…ã¨ã»ã¼åŒã˜ã€‚CasePaths.AnyCasePathã‚’AnyCasePathManualã«å¤‰ãˆãŸã ã‘
    public struct AllCasePaths {
        public var home: AnyCasePathManual<UserActionManual, String> {
            AnyCasePathManual<UserActionManual, String>(
                embed: UserActionManual.home,
                extract: {
                    guard case let .home(v0) = $0 else {
                        return nil
                    }
                    return v0
                }
            )
        }
        public var settings: AnyCasePathManual<UserActionManual, Int> {
            AnyCasePathManual<UserActionManual, Int>(
                embed: UserActionManual.settings,
                extract: {
                    guard case let .settings(v0) = $0 else {
                        return nil
                    }
                    return v0
                }
            )
        }
    }
    public static var allCasePaths: AllCasePaths { AllCasePaths() }
    // ã“ã“ã¾ã§Macroã§ç”Ÿæˆã•ã‚ŒãŸå®Ÿè£…ã¨ã»ã¼åŒã˜

    // æ–°ã—ãè¿½åŠ ã—ãŸã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ãƒˆã€‚\.pathã§å–å¾—ã§ãã‚‹
    subscript<Value>(case keyPath: KeyPath<AllCasePaths, AnyCasePathManual<UserActionManual, Value>>) -> Value
        let casePath = UserActionManual.allCasePaths[keyPath: keyPath] // keyPathã‹ã‚‰casePathã‚’å–å¾—
        return casePath.extract(self) // casePathã‹ã‚‰è‡ªèº«ã®å€¤ã‚’è¿”ã™
    }
}
```

ã“ã‚Œã§å€¤ãŒå–å¾—ã§ãã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã—ãŸğŸ‘

```swift
let manualAction: UserActionManual = .home("manual home")
let manualUserActionHomeValue = manualAction[case: \.home] // Optional("manual home")
```

## ã¾ã¨ã‚

ç†è§£ãŒæ·±ã¾ã£ã¦ã‚ˆã‹ã£ãŸã€‚